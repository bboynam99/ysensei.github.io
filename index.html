<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title></title>
    <link href="css/common.css" rel="stylesheet">
    <link href="css/index.css" rel="stylesheet">
</head>
<body>
<nav>
    <div class="container-wide">
        <div class="row">
            <div class="col m3">
                <a href="javascript:;" class="logo">logo</a>
            </div>
            <div class="col m9">
                <div class="right">
                    <ul>
                        <li>
                            <a href="#h">如何投注</a>
                        </li>
                        <li>
                            <a href="#w">关于项目</a>
                        </li>
                        <li>
                            <a href="javascript:;">Telegram群</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
<div class="container">
    <div class="first-part">
        1 Finney Quiz<div class="head">当前<span id="current-period">--</span>期</div>
        <div class="cont">当前号码<span id="current-num">--</span>，剩余<span id="remain-num">--</span>个号码（投注<span id="remain-eth-num">--</span>ETH即可开奖）</div>
        <div class="info">
            <div class="row">
                <div class="col m5">上期中奖号码：<span id="prize-num">---</span></div>
                <div class="col m5">开奖时间：<span id="prize-time">----年-月-日 --：--：--</span></div>
            </div>
            <div class="row">
                <div class="col m5">中奖地址：<span id="prize-address">------------------------------------------</span></div>
                <div class="col m5">区块高度：<span id="block-height">----</span></div>
            </div>
        </div>
        <div class="btn">
            <a class="more-btn" href="javascript:;">查看更多</a>
        </div>
    </div>
    <div class="second-part">
        <div class="title">如何投注？</div>
        <div class="cont">
            <div class="left">left</div>
            <div class="right">
                <ul>
                    <li>1.打开ImToken类钱包</li>
                    <li>2.扫码或者输入地址：0x1a07369b3df4390d05189cc5bb0f9ad778cc7f7b
                        <img src="" />
                    </li>
                    <li>3.输入0.001倍数的金额（0.001为1注，倍数为多注）</li>
                    <li>4.等待当期售卖完成，自动开奖</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="third-part">
        <div class="title">关于项目</div>
        <div class="cont">
            我们是一个类似于1元云购的ETH项目，您只需要最低投注0.001即可购买一个号码（假如您投注0.01ETH，就会获得10个号码），目前每销售1000个号码，会自动开奖，获奖者会得到0.99个ETH作为回报。

            目前您可以通过交易详情页，通过我们发送给您的ETH金额，得到您当期的投注号码，开奖后，可以核对中奖号码是否在自己投注的号码中。

            我们是一个绝对公平的全部运行在ETH上面的dApp，没有人可以改变程序的结果，您可以去审计我们的代码。
        </div>
        <div class="btn">
            <a href="javascript:;">查看源码</a>
        </div>
    </div>
</div>
<footer>
    <div class="left">Copyright © 2018 igame.cm | All rights reserved</div>
    <div class="right">aaa@gmail.com|  contact us</div>
</footer>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script charset="utf-8" src="https://cdn.ethers.io/scripts/ethers-v2.min.js" type="text/javascript"></script>
<script type="text/javascript">

    var contractAddress = '0x1a07369b3df4390d05189cc5bb0f9ad778cc7f7b';
    var abi = '[{"constant":true,"inputs":[],"name":"getCurrentPeriod","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"winnersResult","outputs":[{"name":"addr","type":"address"},{"name":"number","type":"uint256"},{"name":"blockNumber","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getCurrentNumber","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"address"},{"name":"amount","type":"uint256"}],"name":"getEthers","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"pd","type":"uint256"}],"name":"getPrizeResult","outputs":[{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":true,"stateMutability":"payable","type":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"}]';

    var network = ethers.providers.networks.ropsten;
    var provider = ethers.providers.getDefaultProvider(network); //ropsten测试网络

    //var provider = ethers.providers.getDefaultProvider();
    var contract = new ethers.Contract(contractAddress, abi, provider);

    function getCurrentNum() {
        contract.getCurrentNumber().then(function (result) {
            console.log('CurrentNumber is: ' + result);
            $("#current-num").text(result)
            var num = 1000-parseInt(result)
            $("#remain-num").text(num)
            $("#remain-eth-num").text(num*0.001)
        });
    }

    function getCurrentPeriod() {
        contract.getCurrentPeriod().then(function (result) {
            console.log('currentPeriod is: ' + result);
            $("#current-period").text(result);
            getPrizeResult(--result);
        });
    }

    function getPrizeResult(number) {
        contract.getPrizeResult(number).then(function (result) {
            console.log('PrizeResult is: ' + result);
            $("#prize-num").text(result[1]);
            $("#prize-address").text(result[0]);
            $("#block-height").text(result[2]);
            getTimestamp(parseInt(result[2]));
        });
    }

    function getTimestamp(number) {
        provider.getBlock(number).then(function(block) {
            console.log('blockInfo is: '+block.timestamp);
            var date = new Date();
            date.setTime(block.timestamp * 1000);
            console.log(date.toLocaleString());
            $("#prize-time").text(date.toLocaleString());
        });
    }

    getCurrentNum();
    getCurrentPeriod();

</script>

</body>
</html>